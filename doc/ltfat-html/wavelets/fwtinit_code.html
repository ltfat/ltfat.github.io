 
<!DOCTYPE html>
<html lang="en">
<head class="include" file="../../include/header.html">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta NAME="keywords" CONTENT="gabor, wavelets, filterbank, signal processing, matlab,
octave"/>
<title>FWTINIT - Wavelet Filterbank Structure Initialization</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/css/bootstrap-select.min.css">
<link rel="stylesheet" href="../../include/style.css" type="text/css">
<link rel="stylesheet" href="../../include/highlight.css" type="text/css">
</head>

<!-- body must stay hidden until all include parts are loaded -->
<body style="display:none;">
<!-- Wrap the content into responsive container --!>
<div class="container">
<!-- Include main navigation -->
<div class="masthead include" file="../../include/mainnav.html">
</div>
<div class="row">
    <div class="col-md-2" id="codeswitch"><div id="menutitle"><a href="fwtinit.html">View the help</a></div>
</div>
    <div class="col-md-offset-5 col-md-5" id="jumplist">This is where navigation should be.</div>
</div>
<div class="row">
    <div class="col-md-2">
        <div class="include" file='../include/docnav.html'></div>
        <div id="seealso"><p><div id="menutitle">See also:</div>
<ul>
<li><a href="#BASEURL#/doc/wavelets/fwt.html">fwt</a></li>
<li><a href="#BASEURL#/doc/wavelets/ifwt.html">ifwt</a></li>
<li><a href="#BASEURL#/doc/wavelets/wfilt_db.html">wfilt_db</a></li>
</ul>
</p></div>
    </div>
    <div class="col-md-10">

        <h1 class="title">FWTINIT - Wavelet Filterbank Structure Initialization</h1>
<h2>Program code:</h2>
<div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>[w,info]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">fwtinit</span><span class="p">(</span>wdef,prefix<span class="p">)</span><span class="w"></span>
<span class="c">%FWTINIT  Wavelet Filterbank Structure Initialization</span><span class="w"></span>
<span class="c">%   Usage:  w = fwtinit(wdef);</span><span class="w"></span>
<span class="c">%           w = fwtinit(wdef,prefix);</span><span class="w"></span>
<span class="c">%           [w,info]=fwtinit(...)</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Input parameters:</span><span class="w"></span>
<span class="c">%         wdef   : Wavelet filters specification.</span><span class="w"></span>
<span class="c">%         prefix : Function name prefix</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Output parameters:</span><span class="w"></span>
<span class="c">%         w    : Structure defining the filterbank.</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%   FWTINIT(wdef) produces a structure describing the analysis </span><span class="w"></span>
<span class="c">%   (field w.h) and synthesis (field w.g) filterbanks and a hop factors </span><span class="w"></span>
<span class="c">%   (field w.a) of a basic wavelet-type filterbank defined by wdef.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The analysis filterbank w.h is by default used in FWT and the</span><span class="w"></span>
<span class="c">%   synthesis filterbank w.g in IFWT.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Both w.h and w.g are cell arrays of structs defining FIR filters</span><span class="w"></span>
<span class="c">%   compatible with FILTERBANK, IFILTERBANK and related functions.</span><span class="w"></span>
<span class="c">%   More preciselly, each elemement of either cell array is a struct with</span><span class="w"></span>
<span class="c">%   fields .h and .offset defining impulse response and the initial </span><span class="w"></span>
<span class="c">%   shift respectivelly.</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%   [w,info]=FWTINIT(...) additionally returns a info struct which </span><span class="w"></span>
<span class="c">%   provides some information about the wavelet filterbank:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%      info.istight</span><span class="w"></span>
<span class="c">%         Wavelet filterbank forms a tight frame. In such case, w.h and</span><span class="w"></span>
<span class="c">%         w.g are identical.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The function is a wrapper for calling all the functions with the </span><span class="w"></span>
<span class="c">%   wfilt_ prefix defined in the LTFAT wavelets directory.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The possible formats of the wdef are the following:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   1) Cell array with first element being the name of the function defining</span><span class="w"></span>
<span class="c">%      the basic wavelet filters (wfilt_ prefix) and the other elements</span><span class="w"></span>
<span class="c">%      are the parameters of the function. </span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   2) Character string as concatenation of the name of the wavelet</span><span class="w"></span>
<span class="c">%      filters defining function (as above) and the numeric parameters</span><span class="w"></span>
<span class="c">%      delimited by &#39;:&#39; character. Examples:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%      {&#39;db&#39;,10} or &#39;db10&#39;   </span><span class="w"></span>
<span class="c">%         Daubechies with 10 vanishing moments. It calls wfilt_db(10) </span><span class="w"></span>
<span class="c">%         internally.</span><span class="w"></span>
<span class="c">%      </span><span class="w"></span>
<span class="c">%      {&#39;spline&#39;,4,4} or &#39;spline4:4&#39;  </span><span class="w"></span>
<span class="c">%         Biorthogonal spline wavelet filters with 4 vanishing moments. </span><span class="w"></span>
<span class="c">%         Calls wfilt_spline(4,4) internally.</span><span class="w"></span>
<span class="c">%      </span><span class="w"></span>
<span class="c">%      {&#39;dden&#39;,1} or &#39;dden1&#39;</span><span class="w"></span>
<span class="c">%         Double density wavelet filters. Calls wfilt_dden(1) where</span><span class="w"></span>
<span class="c">%         the filters are stored as numerical vectors.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   3) Cell array of one dimensional numerical vectors directly defining</span><span class="w"></span>
<span class="c">%      the wavelet filter impulse responses.  By default, outputs of the </span><span class="w"></span>
<span class="c">%      filters are subsampled by a factor equal to the number of the </span><span class="w"></span>
<span class="c">%      filters. Pass additional key-value pair &#39;a&#39;,a (still inside of the</span><span class="w"></span>
<span class="c">%      cell array) to define the custom subsampling factors, e.g.: </span><span class="w"></span>
<span class="c">%      {h1,h2,&#39;a&#39;,[2,2]}.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   4) The fourth option is to pass again the structure obtained from the</span><span class="w"></span>
<span class="c">%      FWTINIT function. The structure is checked whether it has a valid</span><span class="w"></span>
<span class="c">%      format.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   5) Two element cell array. First element is the string &#39;dual&#39; and the</span><span class="w"></span>
<span class="c">%      second one is in format 1), 2) or 4). This returns a dual of whatever</span><span class="w"></span>
<span class="c">%      is passed as the second argument.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   6) Two element cell array. First element is the string &#39;strict&#39; and the</span><span class="w"></span>
<span class="c">%      second one is in format 1), 2), 4) or 5). This in the non tight case</span><span class="w"></span>
<span class="c">%      the filters has to be defined explicitly using &#39;ana&#39; and &#39;syn&#39;</span><span class="w"></span>
<span class="c">%      identifiers. See below.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   7) Two element cell array. First element is a cell array of structures</span><span class="w"></span>
<span class="c">%      defining FIR filterbank (.h and .offset fields) as in FILTERBANKWIN</span><span class="w"></span>
<span class="c">%      and the second element is a numeric vector of subsampling factors.</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%   One can interchange the filter in w.h and w.g and use the</span><span class="w"></span>
<span class="c">%   filterbank indended for synthesis in FWT and vice versa by</span><span class="w"></span>
<span class="c">%   re-using the items 1) and 2) in the following way:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   1) Add &#39;ana&#39; or &#39;syn&#39; as the first element in the cell array e.g. </span><span class="w"></span>
<span class="c">%      {&#39;ana&#39;,&#39;spline&#39;,4,4} or {&#39;syn&#39;,&#39;spline&#39;,4,4}.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   2) Add &#39;ana:&#39; or &#39;syn:&#39; to the beginning of the string e.g. </span><span class="w"></span>
<span class="c">%      &#39;ana:spline4:4&#39; or &#39;syn:spline4:4&#39;.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   This only makes difference if the filterbanks are biorthogonal </span><span class="w"></span>
<span class="c">%   (e.g. wfilt_spline) or a general frame (e.g. &#39;symds2&#39;), in other </span><span class="w"></span>
<span class="c">%   cases, the analysis and synthesis filters are identical. </span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Please note that using e.g. c=fwt(f,&#39;ana:spline4:4&#39;,J) and </span><span class="w"></span>
<span class="c">%   fhat=ifwt(c,&#39;ana:spline4:4&#39;,J,size(f,1)) will not give a perfect</span><span class="w"></span>
<span class="c">%   reconstruction.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The output structure has the following additional field:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%      w.origArgs </span><span class="w"></span>
<span class="c">%          Original parameters in format 1).</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   See also: fwt, ifwt, wfilt_db</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   References:</span><span class="w"></span>
<span class="c">%     S. Mallat. A Wavelet Tour of Signal Processing, Third Edition: The</span><span class="w"></span>
<span class="c">%     Sparse Way. Academic Press, 3rd edition, 2008.</span><span class="w"></span>
<span class="c">%     </span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Url: http://ltfat.github.io/doc/wavelets/fwtinit.html</span><span class="w"></span>

<span class="c">% Copyright (C) 2005-2023 Peter L. Soendergaard &lt;peter@sonderport.dk&gt; and others.</span><span class="w"></span>
<span class="c">% This file is part of LTFAT version 2.6.0</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% This program is free software: you can redistribute it and/or modify</span><span class="w"></span>
<span class="c">% it under the terms of the GNU General Public License as published by</span><span class="w"></span>
<span class="c">% the Free Software Foundation, either version 3 of the License, or</span><span class="w"></span>
<span class="c">% (at your option) any later version.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% This program is distributed in the hope that it will be useful,</span><span class="w"></span>
<span class="c">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="w"></span>
<span class="c">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="w"></span>
<span class="c">% GNU General Public License for more details.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% You should have received a copy of the GNU General Public License</span><span class="w"></span>
<span class="c">% along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="w"></span>


<span class="c">%   **Remark:** Function names with the `wfilt_` prefix cannot contain numbers</span><span class="w"></span>
<span class="c">%   and cannot start with &#39;ana&#39; or &#39;syn&#39;! </span><span class="w"></span>



<span class="c">% wavelet filters functions definition prefix</span><span class="w"></span>
<span class="n">wprefix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;wfilt_&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">waveletsDir</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;wavelets&#39;</span><span class="p">;</span><span class="w"></span>

<span class="c">% output structure definition</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">w</span><span class="p">.</span><span class="n">wprefix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wprefix</span><span class="p">;</span><span class="w"></span>
<span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"></span>
<span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">istight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>


<span class="c">% return empty struct if no argument was passed</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="o">&lt;</span><span class="mi">1</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Input argument is empty.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"> </span>
<span class="k">end</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">nargin</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"> </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">prefix</span><span class="p">)</span><span class="w"></span>
<span class="w">       </span><span class="n">wprefix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">prefix</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="n">w</span><span class="p">.</span><span class="n">wprefix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wprefix</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">       </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Bad format of prefix.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="n">do_strict</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">do_dual</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c">% Check &#39;strict&#39;</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">iscell</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">wdef</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wdef</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;strict&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">do_strict</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">wdef</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wdef</span><span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">};</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">iscell</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">wdef</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wdef</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;dual&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">do_dual</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">   </span><span class="n">wdef</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wdef</span><span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">};</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">isstruct</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="w">    </span><span class="c">% Process wdef in format 4)%</span><span class="w"></span>
<span class="w">    </span><span class="c">% Do checks and return quicky %</span><span class="w"></span>
<span class="w">    </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="w">    </span><span class="c">% Check the fields</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">isequal</span><span class="p">(</span><span class="nb">fieldnames</span><span class="p">(</span><span class="n">wdef</span><span class="p">),</span><span class="nb">fieldnames</span><span class="p">(</span><span class="n">w</span><span class="p">))</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">do_dual</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">~</span><span class="n">do_strict</span><span class="w"></span>
<span class="w">           </span><span class="n">w</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wdef</span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="c">%cachw = w;</span><span class="w"></span>
<span class="w">           </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">else</span><span class="w"> </span>
<span class="w">           </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">wdef</span><span class="p">.</span><span class="n">origArgs</span><span class="p">)</span><span class="w"></span>
<span class="w">              </span><span class="n">wdef</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wdef</span><span class="p">.</span><span class="n">origArgs</span><span class="p">;</span><span class="w"></span>
<span class="w">           </span><span class="k">else</span><span class="w"></span>
<span class="w">              </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: The structure was not built using compatible formats.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="w">           </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">       </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Passed structure has different fields.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"> </span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">iscell</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">wname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wdef</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">ischar</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"></span>
<span class="w">       </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="w">       </span><span class="c">% Process wdef in format 3)%</span><span class="w"></span>
<span class="w">       </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="w">       </span><span class="k">if</span><span class="w"> </span><span class="nb">isnumeric</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"></span>
<span class="w">             </span><span class="n">complainDual</span><span class="p">(</span><span class="n">do_dual</span><span class="p">,</span><span class="s">&#39;numeric cell array&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">             </span><span class="n">equalsa</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">wEl</span><span class="p">)</span><span class="nb">strcmp</span><span class="p">(</span><span class="n">wEl</span><span class="p">,</span><span class="s">&#39;a&#39;</span><span class="p">),</span><span class="n">wname</span><span class="p">);</span><span class="w"></span>
<span class="w">             </span><span class="n">apos</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">equalsa</span><span class="o">==</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">             </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">apos</span><span class="p">)</span><span class="w"></span>
<span class="w">                </span><span class="n">apos</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">                </span><span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">),</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">);</span><span class="w"></span>
<span class="w">             </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="n">apos</span><span class="o">==</span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isnumeric</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="n">apos</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="n">apos</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span><span class="o">==</span><span class="n">apos</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">                   </span><span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">{</span><span class="n">apos</span><span class="o">+</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="w">                </span><span class="k">else</span><span class="w"></span>
<span class="w">                   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Key &#39;&#39;a&#39;&#39; have to be followed by a vector of length %i.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">apos</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">                </span><span class="k">end</span><span class="w"></span>
<span class="w">             </span><span class="k">end</span><span class="w"></span>
<span class="w">             </span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">formatFilters</span><span class="p">(</span><span class="n">wname</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">apos</span><span class="o">-</span><span class="mi">1</span><span class="p">),[]);</span><span class="w"></span>
<span class="w">             </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">formatFilters</span><span class="p">(</span><span class="n">wname</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="n">apos</span><span class="o">-</span><span class="mi">1</span><span class="p">),[]);</span><span class="w"></span>
<span class="w">             </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="k">elseif</span><span class="w"> </span><span class="nb">iscell</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="n">complainDual</span><span class="p">(</span><span class="n">do_dual</span><span class="p">,</span><span class="s">&#39;filterbank cell array&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">{</span><span class="mi">2</span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="p">[</span><span class="n">g</span><span class="p">,</span><span class="n">asan</span><span class="p">,</span><span class="n">infotmp</span><span class="p">]=</span><span class="n">filterbankwin</span><span class="p">(</span><span class="n">g</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="s">&#39;normal&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">infotmp</span><span class="p">.</span><span class="n">isfir</span><span class="w"></span>
<span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Only FIR filters are supported.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">            </span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">asan</span><span class="p">(:,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">;</span><span class="w"></span>
<span class="w">       </span><span class="k">else</span><span class="w"></span>
<span class="w">          </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Unrecognizer format of the filterbank definition.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="w">       </span><span class="k">end</span><span class="w"></span>
<span class="w">       </span>
<span class="w">       </span><span class="c">%cachw = w;</span><span class="w"></span>
<span class="w">       </span><span class="k">return</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">wdef</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="w">    </span><span class="c">% Process wdef in format 2)%</span><span class="w"></span>
<span class="w">    </span><span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="w">   </span><span class="k">try</span><span class="w"></span>
<span class="w">       </span><span class="n">wname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">parseNameValPair</span><span class="p">(</span><span class="n">wdef</span><span class="p">,</span><span class="n">wprefix</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="c">% Octave does not support the &quot;catch err&quot; stament, so use &quot;lasterror&quot;</span><span class="w"></span>
<span class="w">       </span><span class="c">% instead    </span><span class="w"></span>
<span class="w">       </span><span class="c">%catch err</span><span class="w"></span>
<span class="w">   </span><span class="k">catch</span><span class="w"></span>
<span class="w">      </span><span class="n">err</span><span class="p">=</span><span class="n">lasterror</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="c">% If failed, clean the cache.</span><span class="w"></span>
<span class="w">      </span><span class="n">cachwDesc</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">      </span><span class="n">cachw</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="n">err</span><span class="p">.</span><span class="n">message</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: First argument must be a string, cell or struct.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="p">;</span><span class="w"></span>

<span class="n">do_forceAna</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">is_tight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c">% Check whether wavelet definition starts with ana or syn</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">ischar</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="o">==</span><span class="mi">3</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;ana&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;syn&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="c">% Set field only if ana or syn was explicitly specified.</span><span class="w"></span>
<span class="w">      </span><span class="n">do_forceAna</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="s">&#39;ana&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">      </span><span class="n">wname</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>



<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">% wname now contains wdef in format 1)%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="c">% Search for m-file containing string wname</span><span class="w"></span>
<span class="n">wfiltFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dir</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">ltfatbasepath</span><span class="p">,</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%s/%s%s.m&#39;</span><span class="p">,</span><span class="n">waveletsDir</span><span class="p">,</span><span class="n">wprefix</span><span class="p">,</span><span class="nb">lower</span><span class="p">(</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">}))));</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">wfiltFile</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Unknown wavelet type: %s&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">wname</span><span class="p">{</span><span class="mi">1</span><span class="p">});</span><span class="w"> </span>
<span class="k">else</span><span class="w"></span>
<span class="w">   </span><span class="c">% if found, crop &#39;.m&#39; from the filename </span><span class="w"></span>
<span class="w">   </span><span class="n">tmpFile</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wfiltFile</span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">);</span><span class="w"> </span>
<span class="k">end</span><span class="w"></span>

<span class="c">% There is a bug in nargout in version 3.6 of Octave, but not in later</span><span class="w"></span>
<span class="c">% stable versions</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="n">isoctave</span><span class="w"></span>
<span class="w">    </span><span class="n">octs</span><span class="p">=</span><span class="nb">strsplit</span><span class="p">(</span><span class="nb">version</span><span class="p">,</span><span class="s">&#39;.&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">octN</span><span class="p">=</span><span class="nb">str2num</span><span class="p">(</span><span class="n">octs</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="o">*</span><span class="mi">1000</span><span class="o">+</span><span class="nb">str2num</span><span class="p">(</span><span class="n">octs</span><span class="p">{</span><span class="mi">2</span><span class="p">});</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">octN</span><span class="o">&lt;</span><span class="mi">3008</span><span class="w"></span>
<span class="w">        </span><span class="k">try</span><span class="w"></span>
<span class="w">            </span><span class="nb">feval</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="k">catch</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>
<span class="n">wfiltNargout</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">nargout</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="p">(</span><span class="nb">nargin</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">)</span><span class="o">~=</span><span class="nb">numel</span><span class="p">(</span><span class="n">wname</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Incorrect number of parameters to be passed to the %s func.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">tmpFile</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="k">if</span><span class="p">(</span><span class="n">wfiltNargout</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="p">[</span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">feval</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span><span class="n">wname</span><span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">});</span><span class="w"></span>
<span class="k">elseif</span><span class="p">(</span><span class="n">wfiltNargout</span><span class="o">==</span><span class="mi">4</span><span class="p">)</span><span class="w"> </span>
<span class="w">   </span><span class="p">[</span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="p">,</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">info</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">feval</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">,</span><span class="n">wname</span><span class="p">{</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">});</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Function %s does not return 3 or 4 arguments.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="nb">upper</span><span class="p">(</span><span class="n">tmpFile</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="o">&amp;&amp;</span><span class="nb">isfield</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;istight&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">is_tight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">istight</span><span class="p">;</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">   </span><span class="n">info</span><span class="p">.</span><span class="n">istight</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% d = [];</span><span class="w"></span>
<span class="c">% if isfield(info,&#39;d&#39;)</span><span class="w"></span>
<span class="c">%    d = info.d;</span><span class="w"></span>
<span class="c">% end</span><span class="w"></span>
<span class="c">% </span><span class="w"></span>
<span class="c">% if numel(tmph)~=numel(w.a) || numel(tmpg)~=numel(w.a)</span><span class="w"></span>
<span class="c">%    error(&#39;%s: Variables returned by %s have different element counts.&#39;,upper(mfilename),upper(tmpFile));</span><span class="w"></span>
<span class="c">% end</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="n">is_tight</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">do_strict</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">do_forceAna</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">([</span><span class="s">&#39;%s: %s filters does not form a tight frame. Choose either &#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="s">&#39;&#39;&#39;ana:%s&#39;&#39; or &#39;&#39;syn:%s&#39;&#39; &#39;</span><span class="p">],</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">tmpFile</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">                                       </span><span class="n">wcell2str</span><span class="p">(</span><span class="n">wname</span><span class="p">),</span><span class="n">wcell2str</span><span class="p">(</span><span class="n">wname</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="w"> </span>
<span class="c">% w.h = formatFilters(tmph,d);</span><span class="w"></span>
<span class="c">% w.g = formatFilters(tmpg,d);</span><span class="w"></span>

<span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wname</span><span class="p">;</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">do_forceAna</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="n">do_dual</span><span class="w"></span>
<span class="w">      </span><span class="n">do_forceAna</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">~</span><span class="n">do_forceAna</span><span class="p">;</span><span class="w"> </span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="n">do_forceAna</span><span class="w"></span>
<span class="w">      </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;ana&#39;</span><span class="p">},</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="c">% Hande the Dual-tree specific stuff</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isfield</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;defaultfirst&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">h</span><span class="p">;</span><span class="w"> </span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;ana&#39;</span><span class="p">},</span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isfield</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;defaultleaf&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">g</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">h</span><span class="p">;</span><span class="w"> </span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;ana&#39;</span><span class="p">},</span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="n">w</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">g</span><span class="p">;</span><span class="w"></span>
<span class="w">      </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;syn&#39;</span><span class="p">},</span><span class="w"> </span><span class="n">w</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="c">% Hande the Dual-tree specific stuff</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isfield</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;defaultfirst&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">g</span><span class="p">;</span><span class="w"> </span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;syn&#39;</span><span class="p">},</span><span class="n">info</span><span class="p">.</span><span class="n">defaultfirst</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">isempty</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isfield</span><span class="p">(</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;defaultleaf&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">g</span><span class="p">;</span><span class="w"> </span>
<span class="w">         </span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">origArgs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[{</span><span class="s">&#39;syn&#39;</span><span class="p">},</span><span class="n">info</span><span class="p">.</span><span class="n">defaultleaf</span><span class="p">.</span><span class="n">origArgs</span><span class="p">];</span><span class="w"></span>
<span class="w">      </span><span class="k">end</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="k">end</span><span class="w"> </span><span class="c">%END FWTINIT</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>filts<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">formatFilters</span><span class="p">(</span>cellf,d<span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">noFilts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">cellf</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">filts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="n">noFilts</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">d</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="n">d</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">findFiltDelays</span><span class="p">(</span><span class="n">cellf</span><span class="p">,</span><span class="s">&#39;half&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="n">ff</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">noFilts</span><span class="w"></span>
<span class="w">      </span><span class="c">%filts{ff} = wfiltstruct(&#39;FIR&#39;);</span><span class="w"></span>
<span class="w">      </span><span class="n">filts</span><span class="p">{</span><span class="n">ff</span><span class="p">}.</span><span class="n">h</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">cellf</span><span class="p">{</span><span class="n">ff</span><span class="p">}(:);</span><span class="w"></span>
<span class="w">      </span><span class="n">filts</span><span class="p">{</span><span class="n">ff</span><span class="p">}.</span><span class="n">offset</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="n">d</span><span class="p">(</span><span class="n">ff</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>

<span class="k">end</span><span class="w"> </span><span class="c">%END FORMATFILTERS</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>wcell<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">parseNameValPair</span><span class="p">(</span>wchar,wprefix<span class="p">)</span><span class="w"></span>
<span class="c">%PARSENAMEVALPAIR</span><span class="w"></span>
<span class="c">%Parses string in the following format wnameN1:N2... , where wname have to</span><span class="w"></span>
<span class="c">%be name of the existing function with wfilt_ prefix. N1,N2,... are doubles</span><span class="w"></span>
<span class="c">%delimited by character &#39;:&#39;.</span><span class="w"></span>
<span class="c">%The output is cell array {wname,str2double(N1),str2double(N2),...}</span><span class="w"></span>
<span class="c">%The wfilt_ function name cannot contain numbers</span><span class="w"></span>

<span class="n">wcell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{};</span><span class="w"> </span>
<span class="n">numDelimiter</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;:&#39;</span><span class="p">;</span><span class="w"></span>

<span class="c">% Check whether the first 4 characters are &#39;ana:&#39; or &#39;syn:&#39;</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">wchar</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">4</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wchar</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">),</span><span class="s">&#39;ana:&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wcell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">wcell</span><span class="p">,{</span><span class="s">&#39;ana&#39;</span><span class="p">}];</span><span class="w"></span>
<span class="w">      </span><span class="n">wchar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wchar</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">elseif</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wchar</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">),</span><span class="s">&#39;syn:&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">      </span><span class="n">wcell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">wcell</span><span class="p">,{</span><span class="s">&#39;syn&#39;</span><span class="p">}];</span><span class="w"></span>
<span class="w">      </span><span class="n">wchar</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wchar</span><span class="p">(</span><span class="mi">5</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% Take out all numbers from the string</span><span class="w"></span>
<span class="n">wcharNoNum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wchar</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">find</span><span class="p">(</span><span class="nb">isstrprop</span><span class="p">(</span><span class="n">wchar</span><span class="p">,</span><span class="s">&#39;digit&#39;</span><span class="p">)</span><span class="o">~=</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="c">% List all files satysfying the following: [ltfatbase]/wavelets/wfilt_*.m?</span><span class="w"></span>
<span class="n">wfiltFiles</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">dir</span><span class="p">(</span><span class="nb">fullfile</span><span class="p">(</span><span class="n">ltfatbasepath</span><span class="p">,</span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%s/%s*.m&#39;</span><span class="p">,</span><span class="s">&#39;wavelets&#39;</span><span class="p">,</span><span class="n">wprefix</span><span class="p">)));</span><span class="w"></span>
<span class="c">% Get just the filanames without the wfilt_ prefix</span><span class="w"></span>
<span class="n">wfiltNames</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">arrayfun</span><span class="p">(@(</span><span class="n">fEl</span><span class="p">)</span><span class="w"> </span><span class="n">fEl</span><span class="p">.</span><span class="n">name</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="nb">find</span><span class="p">(</span><span class="n">fEl</span><span class="p">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;_&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span><span class="nb">find</span><span class="p">(</span><span class="n">fEl</span><span class="p">.</span><span class="n">name</span><span class="o">==</span><span class="s">&#39;.&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;last&#39;</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">wfiltFiles</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="c">% Compare the filenames with a given string</span><span class="w"></span>
<span class="n">wcharMatch</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">nEl</span><span class="p">)</span><span class="w"> </span><span class="nb">strcmpi</span><span class="p">(</span><span class="n">wcharNoNum</span><span class="p">,</span><span class="n">nEl</span><span class="p">),</span><span class="n">wfiltNames</span><span class="p">);</span><span class="w"></span>
<span class="c">% Find index(es) of the matches.</span><span class="w"></span>
<span class="n">wcharMatchIdx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">wcharMatch</span><span class="o">~=</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="c">% Handle faulty results.</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">wcharMatchIdx</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="n">dirListStr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">wEl</span><span class="p">)</span><span class="w"> </span><span class="nb">sprintf</span><span class="p">(</span><span class="s">&#39;%s, &#39;</span><span class="p">,</span><span class="n">wEl</span><span class="p">),</span><span class="w"> </span><span class="n">wfiltNames</span><span class="p">(:)</span><span class="o">&#39;</span><span class="p">,</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">));</span><span class="w"></span>
<span class="w">   </span><span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="nb">all</span><span class="p">(</span><span class="nb">cellfun</span><span class="p">(@</span><span class="nb">isempty</span><span class="p">,</span><span class="n">wfiltNames</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Unknown wavelet filter definition string: %s.\nAccepted are:\n%s&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">wcharNoNum</span><span class="p">,</span><span class="n">dirListStr</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">2</span><span class="p">));</span><span class="w"></span>
<span class="w">   </span><span class="k">else</span><span class="w"></span>
<span class="w">      </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Cannot find %s%s&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">wprefix</span><span class="p">,</span><span class="n">wcharNoNum</span><span class="p">);</span><span class="w"> </span>
<span class="w">   </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">wcharMatchIdx</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Ambiguous wavelet filter definition string. Probably bug somewhere.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="n">match</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wfiltNames</span><span class="p">{</span><span class="n">wcharMatchIdx</span><span class="p">};</span><span class="w"></span>
<span class="n">wcell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">wcell</span><span class="p">,{</span><span class="n">match</span><span class="p">}];</span><span class="w"></span>
<span class="c">% Extract the numerical parameters from the string (delimited by :)</span><span class="w"></span>
<span class="n">numString</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">wchar</span><span class="p">(</span><span class="nb">numel</span><span class="p">(</span><span class="n">match</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">numString</span><span class="p">))</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: No numeric parameter specified in %s.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">wchar</span><span class="p">);</span><span class="w"> </span>
<span class="k">end</span><span class="w"></span>
<span class="c">% Parse the numbers.</span><span class="w"></span>
<span class="n">wcharNum</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">textscan</span><span class="p">(</span><span class="n">numString</span><span class="p">,</span><span class="s">&#39;%f&#39;</span><span class="p">,</span><span class="s">&#39;Delimiter&#39;</span><span class="p">,</span><span class="n">numDelimiter</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="p">(</span><span class="o">~</span><span class="nb">isnumeric</span><span class="p">(</span><span class="n">wcharNum</span><span class="p">{</span><span class="mi">1</span><span class="p">})</span><span class="o">||</span><span class="nb">any</span><span class="p">(</span><span class="nb">isnan</span><span class="p">(</span><span class="n">wcharNum</span><span class="p">{</span><span class="mi">1</span><span class="p">})))</span><span class="w"></span>
<span class="w">   </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Incorrect numeric part of the wavelet filter definition string.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
<span class="n">wcell</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">wcell</span><span class="p">,</span><span class="w"> </span><span class="nb">num2cell</span><span class="p">(</span><span class="n">wcharNum</span><span class="p">{</span><span class="mi">1</span><span class="p">}).</span><span class="o">&#39;</span><span class="p">];</span><span class="w"></span>
<span class="k">end</span><span class="w"> </span><span class="c">%END PARSENAMEVALPAIR</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>d<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">findFiltDelays</span><span class="p">(</span>cellh,type<span class="p">)</span><span class="w"></span>
<span class="w">   </span><span class="n">filtNo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">numel</span><span class="p">(</span><span class="n">cellh</span><span class="p">);</span><span class="w"></span>
<span class="w">   </span><span class="n">d</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">ones</span><span class="p">(</span><span class="n">filtNo</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>

<span class="w">   </span><span class="k">for</span><span class="w"> </span><span class="n">ff</span><span class="p">=</span><span class="mi">1</span><span class="p">:</span><span class="n">filtNo</span><span class="w"></span>
<span class="w">       </span><span class="k">if</span><span class="p">(</span><span class="nb">strcmp</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span><span class="s">&#39;half&#39;</span><span class="p">))</span><span class="w"></span>
<span class="w">               </span><span class="n">d</span><span class="p">(</span><span class="n">ff</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">floor</span><span class="p">((</span><span class="nb">length</span><span class="p">(</span><span class="n">cellh</span><span class="p">{</span><span class="n">ff</span><span class="p">})</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">);</span><span class="w"></span>
<span class="c">%        elseif(strcmp(type,&#39;energycent&#39;))</span><span class="w"></span>
<span class="c">%            tmphh =cellh{ff};</span><span class="w"></span>
<span class="c">%            tmphLen = length(tmphh);</span><span class="w"></span>
<span class="c">%            ecent = sum((1:tmphLen-1).*tmphh(2:end).^2)/sum(tmphh.^2);</span><span class="w"></span>
<span class="c">%            if(do_ana)</span><span class="w"></span>
<span class="c">%                d(ff) = round(ecent)+1;</span><span class="w"></span>
<span class="c">%                if(rem(abs(d(ff)-d(1)),2)~=0)</span><span class="w"></span>
<span class="c">%                   d(ff)=d(ff)+1;</span><span class="w"></span>
<span class="c">%                end</span><span class="w"></span>
<span class="c">%            else</span><span class="w"></span>
<span class="c">%                anad = round(ecent)+1;</span><span class="w"></span>
<span class="c">%                d(ff) = tmphLen-anad;</span><span class="w"></span>
<span class="c">%                if(rem(abs(d(ff)-d(1)),2)~=0)</span><span class="w"></span>
<span class="c">%                   d(ff)=d(ff)-1;</span><span class="w"></span>
<span class="c">%                end</span><span class="w"></span>
<span class="c">%            end</span><span class="w"></span>

<span class="w">       </span><span class="k">else</span><span class="w">        </span>
<span class="w">           </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;TO DO: Unsupported type.&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">end</span><span class="w"></span>
<span class="w">  </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"> </span><span class="c">%END FINDFILTDELAYS</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="nf">complainDual</span><span class="p">(</span>dual,whereStr<span class="p">)</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="n">dual</span><span class="w"></span>
<span class="w">  </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: &#39;&#39;dual&#39;&#39; option not allowed for the %s input.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="n">whereStr</span><span class="p">);</span><span class="w"> </span>
<span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"> </span><span class="c">% END COMPLAINA</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>str<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">wcell2str</span><span class="p">(</span>wcell<span class="p">)</span><span class="w"></span>
<span class="n">strNums</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cellfun</span><span class="p">(@(</span><span class="n">wEl</span><span class="p">)</span><span class="w"> </span><span class="p">[</span><span class="nb">num2str</span><span class="p">(</span><span class="n">wEl</span><span class="p">),</span><span class="s">&#39;:&#39;</span><span class="p">],</span><span class="n">wcell</span><span class="p">(</span><span class="mi">2</span><span class="p">:</span><span class="k">end</span><span class="p">),</span><span class="s">&#39;UniformOutput&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>
<span class="n">strNums</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell2mat</span><span class="p">(</span><span class="n">strNums</span><span class="p">);</span><span class="w"></span>
<span class="n">str</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">wcell</span><span class="p">{</span><span class="mi">1</span><span class="p">},</span><span class="n">strNums</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="k">end</span><span class="o">-</span><span class="mi">1</span><span class="p">)];</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>


        <div class="include" file="../../include/footer.html"></div>
    </div>
</div>
<!-- These two have to be here to dynamically load the included parts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/js/bootstrap-select.min.js"></script>
<script src="../../js/ltfat.js" type="text/javascript"></script>
<script src="../include/lookup.js" type="text/javascript"></script>
<script src="../include/jumplist.js" type="text/javascript"></script>
</body>
</html>

