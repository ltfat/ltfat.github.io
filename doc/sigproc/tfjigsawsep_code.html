 
<!DOCTYPE html>
<html lang="en">
<head class="include" file="../../include/header.html">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta NAME="keywords" CONTENT="gabor, wavelets, filterbank, signal processing, matlab,
octave"/>
<title>TFJIGSAWSEP - Time frequency jigsaw puzzle tonal-transient separation</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap-theme.min.css">
<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/css/bootstrap-select.min.css">
<link rel="stylesheet" href="../../include/style.css" type="text/css">
<link rel="stylesheet" href="../../include/highlight.css" type="text/css">
</head>

<!-- body must stay hidden until all include parts are loaded -->
<body style="display:none;">
<!-- Wrap the content into responsive container --!>
<div class="container">
<!-- Include main navigation -->
<div class="masthead include" file="../../include/mainnav.html">
</div>
<div class="row">
    <div class="col-md-2" id="codeswitch"><div id="menutitle"><a href="tfjigsawsep.html">View the help</a></div>
</div>
    <div class="col-md-offset-5 col-md-5" id="jumplist">This is where navigation should be.</div>
</div>
<div class="row">
    <div class="col-md-2">
        <div class="include" file='../include/docnav.html'></div>
        <div id="seealso"><p></p></div>
    </div>
    <div class="col-md-10">

        <h1 class="title">TFJIGSAWSEP - Time frequency jigsaw puzzle tonal-transient separation</h1>
<h2>Program code:</h2>
<div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span><span class="nf">[ fplanes,cplanes,info ] = tfjigsawsep</span><span class="p">(</span> f, varargin <span class="p">)</span><span class="w"></span>
<span class="c">%TFJIGSAWSEP Time frequency jigsaw puzzle tonal-transient separation</span><span class="w"></span>
<span class="c">%   Usage:  fplanes = tfjigsawsep(f);</span><span class="w"></span>
<span class="c">%           fplanes = tfjigsawsep(f,r1,r2);</span><span class="w"></span>
<span class="c">%           fplanes = tfjigsawsep(f,r1,r2,p);</span><span class="w"></span>
<span class="c">%           [fplanes, cplanes, info] = tfjigsawsep(...);</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Input parameters:</span><span class="w"></span>
<span class="c">%            f        : Input signal</span><span class="w"></span>
<span class="c">%            r1       : Significance level of the tonal layer refered to</span><span class="w"></span>
<span class="c">%                       a white noise reference</span><span class="w"></span>
<span class="c">%            r2       : Same for the transient layer</span><span class="w"></span>
<span class="c">%            p        : Proportionfactor of the supertilesizes relative </span><span class="w"></span>
<span class="c">%                       to the time-, and frequency stepsize </span><span class="w"></span>
<span class="c">%    </span><span class="w"></span>
<span class="c">%   Output parameters:</span><span class="w"></span>
<span class="c">%           fplanes   : signallength-by-3 array containing the 3 produced</span><span class="w"></span>
<span class="c">%                       layers, tonal in fplanes(:,1), transient in</span><span class="w"></span>
<span class="c">%                       fplanes(:,2) and the noisy residual in fplanes(:,3).</span><span class="w"></span>
<span class="c">%           cplanes   : 3-by-1 cellarray containing the Gabor coefficients</span><span class="w"></span>
<span class="c">%                       for the individual layers</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   TFJIGSAWSEP(f) applies the separation algorithm on the input signal f*</span><span class="w"></span>
<span class="c">%   and returns the tonal, the transient and the residual parts.</span><span class="w"></span>
<span class="c">%   The following default values are used, r1=r2=0.95, p=4 and for the </span><span class="w"></span>
<span class="c">%   3 Gabor systems:</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%       &quot;Tonal&quot; system:     g1 = {&#39;hann&#39;,4096}; a1 = 512; M1 = 4096;</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%       &quot;Transient&quot; system: g2 = {&#39;hann&#39;,256};  a2 = 32;  M2 = 256;</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &quot;Residual&quot; system:  g3 = {&#39;hann&#39;,2048}; a3 = 512; M3 = 2048;</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%   TFJIGSAWSEP(f,r1,r2) works as before, but allows changing threshold</span><span class="w"></span>
<span class="c">%   parameters r1 and r2. Good values are in range [0.85,0.95]. </span><span class="w"></span>
<span class="c">%   t2 sometimes has to be chosen larger (~ 1.05), eg. for </span><span class="w"></span>
<span class="c">%   percussions in music signals.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   TFJIGSAWSEP(f,r1,r2,p) (recommended) additionally allows changing the</span><span class="w"></span>
<span class="c">%   size of the supertiles to a1*p in timesamples and b2*p in</span><span class="w"></span>
<span class="c">%   frequencysamples. The choice of this particular proportion is</span><span class="w"></span>
<span class="c">%   reasonable since it provides equal numbers of coefficients of the two</span><span class="w"></span>
<span class="c">%   Gabor systems in each supertile. Good values are in the range of [1,10],</span><span class="w"></span>
<span class="c">%   but it depends very much on the type of signal.</span><span class="w"></span>
<span class="c">%   E.g. for speech signals, higher values yield better results.   </span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   [fplanes, cplanes, info] = TFJIGSAWSEP(...) additionally returns</span><span class="w"></span>
<span class="c">%   a 3 element cell array cplanes containing DGTREAL coefficients</span><span class="w"></span>
<span class="c">%   of the respective separated layers and a structure info, with the</span><span class="w"></span>
<span class="c">%   parameters used in the algorithm. The relationship between fplanes*</span><span class="w"></span>
<span class="c">%   and cplanes is the following:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Url: http://ltfat.github.io/doc/sigproc/tfjigsawsep.html</span><span class="w"></span>

<span class="c">% Copyright (C) 2005-2022 Peter L. Soendergaard &lt;peter@sonderport.dk&gt; and others.</span><span class="w"></span>
<span class="c">% This file is part of LTFAT version 2.5.0</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% This program is free software: you can redistribute it and/or modify</span><span class="w"></span>
<span class="c">% it under the terms of the GNU General Public License as published by</span><span class="w"></span>
<span class="c">% the Free Software Foundation, either version 3 of the License, or</span><span class="w"></span>
<span class="c">% (at your option) any later version.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% This program is distributed in the hope that it will be useful,</span><span class="w"></span>
<span class="c">% but WITHOUT ANY WARRANTY; without even the implied warranty of</span><span class="w"></span>
<span class="c">% MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><span class="w"></span>
<span class="c">% GNU General Public License for more details.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">% You should have received a copy of the GNU General Public License</span><span class="w"></span>
<span class="c">% along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span><span class="w"></span>

<span class="c">%   Additional parameters:</span><span class="w"></span>
<span class="c">%   ----------------------</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The function accepts the following flags:</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;ver2&#39; Uses the second version of the algorithm.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;plot&#39; Plots the separated waveforms and the coefficients.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;verbose&#39; Information about the boundary condition.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   and the following key-value pairs:</span><span class="w"></span>
<span class="c">%      </span><span class="w"></span>
<span class="c">%       &#39;wintype&#39; Requested windowtype</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;winsize1&#39; and &#39;winsize2&#39; Windowlengths</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;a1&#39; and &#39;a2&#39; Time stepsizes</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;M1&#39; and &#39;M2&#39; Number of frequency channels</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;T&#39; and &#39;F&#39; Supertile sizes in samples manually - alternative to p!</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%       &#39;maxit&#39; Maximum number of iterations. The default value is 15.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Algorithm:</span><span class="w"></span>
<span class="c">%   ----------</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   The algorithm is based on [1]. It transforms a signal into a two-windowed</span><span class="w"></span>
<span class="c">%   Gabor expansion such that one wide window shall lead to a high frequency</span><span class="w"></span>
<span class="c">%   resolution (tonal layer is represented well) and a narrow one to a high</span><span class="w"></span>
<span class="c">%   time resolution (transient layer is repr. well). The resulting Gabor</span><span class="w"></span>
<span class="c">%   coefficients are respectively considered within rectangular &#39;supertiles&#39;</span><span class="w"></span>
<span class="c">%   in the time-frequency plane. An entropy criterion chooses those tiles</span><span class="w"></span>
<span class="c">%   respectively, where tonal and transient parts of the signal are</span><span class="w"></span>
<span class="c">%   represented better and are below a estimated threshold. The rest is set</span><span class="w"></span>
<span class="c">%   to zero. The leftover Gabor coefficients are transformed back and</span><span class="w"></span>
<span class="c">%   subtracted from the original signal. By applying this procedure</span><span class="w"></span>
<span class="c">%   iteratively on the residual, tonal and transient layers emerge.</span><span class="w"></span>
<span class="c">%</span><span class="w"></span>
<span class="c">%   Examples:</span><span class="w"></span>
<span class="c">%   ---------</span><span class="w"></span>
<span class="c">%   </span><span class="w"></span>
<span class="c">%   The following example shows the basic usage of the function:::</span><span class="w"></span>
<span class="c">%     </span><span class="w"></span>
<span class="c">%     % Load the glockenspiel test signal and add some noise</span><span class="w"></span>
<span class="c">%     [f,fs] = gspi; f = f + 0.001*randn(size(f));</span><span class="w"></span>
<span class="c">%     % Setup the parameters</span><span class="w"></span>
<span class="c">%     p = 2; r1 = 0.92; r2 = 0.93;</span><span class="w"></span>
<span class="c">%     [fplanes,cplanes,info] = tfjigsawsep(f,r1,r2,p,&#39;plot&#39;,&#39;ver2&#39;,&#39;fs&#39;,fs);</span><span class="w"></span>
<span class="c">%     </span><span class="w"></span>
<span class="c">%   See also: dgtreal plottfjigsawsep</span><span class="w"></span>
<span class="c">%         </span><span class="w"></span>
<span class="c">%   References: jato07</span><span class="w"></span>

<span class="c">%AUTHOR: Daniel Haider, 2017 </span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Remarks %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%   The residual condition is computed very heuristically, designing it   %</span><span class="w"></span>
<span class="c">%   more flexible would be a nice improvement of the algorithm.           %</span><span class="w"></span>
<span class="c">%   It would also be useful to provide parameter settings for specific    %</span><span class="w"></span>
<span class="c">%   types of signals (ie. speech, music,...) .                            %</span><span class="w"></span>
<span class="c">%                                                                         %</span><span class="w"></span>
<span class="c">%   Version 1 of the algorithm (default) works particularly well for      %</span><span class="w"></span>
<span class="c">%   speech signals, but also for depicting the transient layer            %</span><span class="w"></span>
<span class="c">%   (eg. percussive elements) nicely in musical signals.                  %</span><span class="w"></span>
<span class="c">%   Version 2 works particularly well for depicting a nice tonal layer.   %</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>


<span class="p">[</span><span class="n">f</span><span class="p">,</span><span class="n">Ls</span><span class="p">,</span><span class="n">W</span><span class="p">,</span><span class="n">wasrow</span><span class="p">,</span><span class="n">remembershape</span><span class="p">]=</span><span class="n">comp_sigreshape_pre</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="mi">0</span><span class="p">);</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">W</span><span class="o">&gt;</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Multichannel inputs are not supported.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">r1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">r2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">F</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">wintype</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="s">&#39;hann&#39;</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">winsize1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">a1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">M1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4096</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">winsize2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">64</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">M2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">maxit</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">keyvals</span><span class="p">.</span><span class="n">fs</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[];</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">algver</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;ver1&#39;</span><span class="p">,</span><span class="s">&#39;ver2&#39;</span><span class="p">};</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">plot</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;noplot&#39;</span><span class="p">,</span><span class="s">&#39;plot&#39;</span><span class="p">};</span><span class="w"></span>
<span class="n">definput</span><span class="p">.</span><span class="n">flags</span><span class="p">.</span><span class="n">verbose</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;noverbose&#39;</span><span class="p">,</span><span class="s">&#39;verbose&#39;</span><span class="p">};</span><span class="w"></span>
<span class="p">[</span><span class="n">flags</span><span class="p">,</span><span class="n">kv</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ltfatarghelper</span><span class="p">({</span><span class="s">&#39;r1&#39;</span><span class="p">,</span><span class="s">&#39;r2&#39;</span><span class="p">,</span><span class="s">&#39;p&#39;</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="s">&#39;F&#39;</span><span class="p">,</span><span class="s">&#39;wintype&#39;</span><span class="p">,</span><span class="s">&#39;winsize1&#39;</span><span class="p">,</span><span class="s">&#39;a1&#39;</span><span class="p">,</span><span class="s">&#39;M1&#39;</span><span class="p">,</span><span class="s">&#39;winsize2&#39;</span><span class="p">,</span><span class="s">&#39;a2&#39;</span><span class="p">,</span><span class="s">&#39;M2&#39;</span><span class="p">},</span><span class="n">definput</span><span class="p">,</span><span class="nb">varargin</span><span class="p">);</span><span class="w"></span>

<span class="c">% significance level</span><span class="w"></span>
<span class="n">r1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">r1</span><span class="p">;</span><span class="w"></span>
<span class="n">r2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">r2</span><span class="p">;</span><span class="w"></span>
<span class="c">% Gabor system settings</span><span class="w"></span>
<span class="n">wintype</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">wintype</span><span class="p">;</span><span class="w"></span>
<span class="n">winsize1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">winsize1</span><span class="p">;</span><span class="w"></span>
<span class="n">a1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">a1</span><span class="p">;</span><span class="w"></span>
<span class="n">M1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">M1</span><span class="p">;</span><span class="w"></span>
<span class="n">winsize2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">winsize2</span><span class="p">;</span><span class="w"></span>
<span class="n">a2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">a2</span><span class="p">;</span><span class="w"></span>
<span class="n">M2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">M2</span><span class="p">;</span><span class="w"></span>
<span class="c">% supertile sizes</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">T</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">F</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="n">p</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">a1</span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">)</span><span class="o">/</span><span class="n">M2</span><span class="o">*</span><span class="n">p</span><span class="p">;</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">kv</span><span class="p">.</span><span class="n">p</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">T</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">F</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">F</span><span class="p">;</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Use EITHER the proportional setting OR set T and F manually.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">winsize1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">winsize2</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: The tonal system uses a shorter window than the transient system!&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% why this and not setting the kv on top?</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">xor</span><span class="p">(</span><span class="nb">isempty</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="nb">isempty</span><span class="p">(</span><span class="n">r2</span><span class="p">))</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Both r1 and r2 must be defined.&#39;</span><span class="p">,</span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">));</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">r1</span><span class="p">),</span><span class="w"> </span><span class="n">r1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.95</span><span class="p">;</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">r2</span><span class="p">),</span><span class="w"> </span><span class="n">r2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">0.95</span><span class="p">;</span><span class="w"> </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w">  </span>

<span class="c">% windows</span><span class="w"></span>
<span class="n">g1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">wintype</span><span class="p">,</span><span class="n">winsize1</span><span class="p">};</span><span class="w"></span>
<span class="n">g2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">wintype</span><span class="p">,</span><span class="n">winsize2</span><span class="p">};</span><span class="w"></span>

<span class="n">L1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"></span>
<span class="n">L2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"></span>
<span class="n">b1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L1</span><span class="o">/</span><span class="n">M1</span><span class="p">;</span><span class="w"></span>
<span class="n">b2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L2</span><span class="o">/</span><span class="n">M2</span><span class="p">;</span><span class="w"></span>

<span class="n">complainif_notposint</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="s">&#39;T&#39;</span><span class="p">,</span><span class="nb">mfilename</span><span class="p">);</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">min</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Supertile length must be smaller than the signal length [%i]&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="nb">min</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">]));</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nb">min</span><span class="p">([</span><span class="n">L1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">L2</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Supertile height must be smaller than the frequency range [%i]&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">      </span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="nb">min</span><span class="p">([</span><span class="n">L1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">L2</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">]));</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">max</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Supertile length must be larger than the time stepsizes [%i]&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="nb">max</span><span class="p">([</span><span class="n">a1</span><span class="p">,</span><span class="n">a1</span><span class="p">]));</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="o">~</span><span class="p">(</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nb">max</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">])</span><span class="w"> </span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;%s: Supertile height must be larger than the frequency stepsizes [%i]&#39;</span><span class="p">,</span><span class="k">...</span><span class="w"></span>
<span class="w">          </span><span class="nb">upper</span><span class="p">(</span><span class="nb">mfilename</span><span class="p">),</span><span class="nb">max</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span><span class="n">b2</span><span class="p">]));</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% entropy reference from noise signal</span><span class="w"></span>
<span class="c">% thresholds tau1,tau2 for tonal resp. transient layer are chosen to have</span><span class="w"></span>
<span class="c">% a certain significance with respect to the estimated reference</span><span class="w"></span>
<span class="p">[</span><span class="n">ref1</span><span class="p">,</span><span class="n">ref2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">noisest</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">tau1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ref1</span><span class="o">*</span><span class="n">r1</span><span class="p">;</span><span class="w"></span>
<span class="n">tau2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ref2</span><span class="o">*</span><span class="n">r2</span><span class="p">;</span><span class="w"></span>

<span class="c">% initialization of residual, layers, min and max number of iterations</span><span class="w"></span>
<span class="c">% and epsilon, the upper limit for the residual condition, which is</span><span class="w"></span>
<span class="c">% computed at the kmin-th iteration</span><span class="w"></span>
<span class="c">% R = postpad(f,L);</span><span class="w"></span>
<span class="n">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">f</span><span class="p">;</span><span class="w"></span>
<span class="n">l1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">l2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">kmin</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="p">;</span><span class="w"></span>
<span class="n">kmax</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">kv</span><span class="p">.</span><span class="n">maxit</span><span class="p">;</span><span class="w"></span>
<span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%% main loop %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="c">% runs until all values in R are below epsilon to exclude single peaks </span><span class="w"></span>
<span class="k">while</span><span class="w"> </span><span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">epsilon</span><span class="p">)</span><span class="w"> </span><span class="o">~=</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>

<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span><span class="n">algver</span><span class="w"></span>
<span class="w">       </span><span class="k">case</span><span class="w"> </span><span class="s">&#39;ver1&#39;</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">]=</span><span class="n">jigsaw1</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="w">       </span><span class="k">case</span><span class="w"> </span><span class="s">&#39;ver2&#39;</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">]=</span><span class="n">jigsaw2</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">T</span><span class="p">,</span><span class="n">F</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="c">% residual parts of the signal</span><span class="w"></span>
<span class="w">    </span><span class="n">R</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">R</span><span class="o">-</span><span class="n">x1</span><span class="o">-</span><span class="n">x2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">l1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">l1</span><span class="o">+</span><span class="n">x1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">l2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">l2</span><span class="o">+</span><span class="n">x2</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kmax</span><span class="w"></span>
<span class="w">        </span><span class="k">break</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">kmin</span><span class="w"></span>
<span class="w">        </span><span class="c">% epsilon is computed as upper limit, corresponding to</span><span class="w"></span>
<span class="w">        </span><span class="c">% an empirical p-quantile</span><span class="w"></span>
<span class="w">        </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">sort</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">),</span><span class="s">&#39;ascend&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">epsilon</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">5</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">epsilon</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="mf">0.998</span><span class="o">*</span><span class="nb">numel</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)));</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span><span class="n">do_verbose</span><span class="w"></span>
<span class="w">            </span><span class="nb">disp</span><span class="p">([</span><span class="s">&#39;The current maximum in the residual is &#39;</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">R</span><span class="p">)))])</span><span class="w"></span>
<span class="w">            </span><span class="nb">disp</span><span class="p">([</span><span class="s">&#39;An upper bound is estimated to be &#39;</span><span class="p">,</span><span class="nb">num2str</span><span class="p">(</span><span class="n">epsilon</span><span class="p">)])</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="n">k</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span><span class="n">do_verbose</span><span class="w"></span>
<span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;max. number of iteration reached: condition for residual is not fulfilled!&#39;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="nb">disp</span><span class="p">(</span><span class="s">&#39;Try to increase t2 slightly or change the size of the supertiles.&#39;</span><span class="p">)</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% fplanes as Ls-by-3 array containing the layers</span><span class="w"></span>
<span class="n">fplanes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">l1</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">R</span><span class="p">];</span><span class="w"></span>
<span class="n">fplanes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">postpad</span><span class="p">(</span><span class="n">fplanes</span><span class="p">,</span><span class="n">Ls</span><span class="p">);</span><span class="w"></span>

<span class="c">% info structure</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">g1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">wintype</span><span class="p">,</span><span class="w"> </span><span class="n">winsize1</span><span class="p">};</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">g2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">wintype</span><span class="p">,</span><span class="w"> </span><span class="n">winsize2</span><span class="p">};</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">g3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">{</span><span class="n">wintype</span><span class="p">,</span><span class="w"> </span><span class="mi">2048</span><span class="p">};</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">M1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">M1</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">M2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">M2</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">M3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2048</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">a1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">a1</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">a2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">a2</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">a3</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">512</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">supertilesizes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[</span><span class="n">F</span><span class="p">,</span><span class="n">T</span><span class="p">];</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">noiseentropy_tonal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ref1</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">threshold_tonal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tau1</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">noiseentropy_transient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ref2</span><span class="p">;</span><span class="w"></span>
<span class="n">info</span><span class="p">.</span><span class="n">threshold_transient</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">tau2</span><span class="p">;</span><span class="w"></span>

<span class="c">% cplanes as 3-by-1 cell array containing</span><span class="w"></span>
<span class="c">% the gabor coefficients corresp. to the layers</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="nb">nargout</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span><span class="n">do_plot</span><span class="w"></span>
<span class="w">    </span><span class="n">cplanes</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">cell</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">cplanes</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">cplanes</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">cplanes</span><span class="p">{</span><span class="mi">3</span><span class="p">}</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">info</span><span class="p">.</span><span class="n">g3</span><span class="p">,</span><span class="n">info</span><span class="p">.</span><span class="n">a3</span><span class="p">,</span><span class="n">info</span><span class="p">.</span><span class="n">M3</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% option for plots</span><span class="w"></span>
<span class="k">if</span><span class="w"> </span><span class="n">flags</span><span class="p">.</span><span class="n">do_plot</span><span class="w"></span>
<span class="w">    </span><span class="n">plottfjigsawsep</span><span class="p">(</span><span class="n">fplanes</span><span class="p">,</span><span class="n">cplanes</span><span class="p">,</span><span class="n">info</span><span class="p">,</span><span class="s">&#39;fs&#39;</span><span class="p">,</span><span class="n">kv</span><span class="p">.</span><span class="n">fs</span><span class="p">,</span><span class="s">&#39;showbuttons&#39;</span><span class="p">,</span><span class="s">&#39;equalyrange&#39;</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>


<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%% compiling functions %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span><span class="nf">[ r ] = renyi</span><span class="p">(</span> t,alpha <span class="p">)</span><span class="w"></span>

<span class="c">% computes the Renyi entropy for an array</span><span class="w"></span>
<span class="c">% yields high values for peaky data and</span><span class="w"></span>
<span class="c">% low values for almost constant</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">isempty</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"></span>
<span class="k">elseif</span><span class="w"> </span><span class="nb">norm</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="w"></span>
<span class="w">    </span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">inf</span><span class="p">;</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="nb">nargin</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">            </span><span class="nb">alpha</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mf">2.4</span><span class="p">;</span><span class="w"></span>
<span class="w">            </span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">alpha</span><span class="p">))</span><span class="o">*</span><span class="nb">log2</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.^</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">alpha</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="p">))</span><span class="o">.^</span><span class="p">(</span><span class="o">-</span><span class="nb">alpha</span><span class="p">)));</span><span class="w"></span>
<span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="mi">2</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="nb">alpha</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nb">alpha</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"></span>
<span class="w">                </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;alpha must be chosen positive and unequal to 1.&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">else</span><span class="w"></span>
<span class="w">                </span><span class="n">r</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">alpha</span><span class="p">))</span><span class="o">*</span><span class="nb">log2</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">.^</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="nb">alpha</span><span class="p">)))</span><span class="o">.*</span><span class="nb">norm</span><span class="p">(</span><span class="n">t</span><span class="p">(:),</span><span class="mi">2</span><span class="p">)</span>^<span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="nb">alpha</span><span class="p">));</span><span class="w"></span>
<span class="w">            </span><span class="k">end</span><span class="w"></span>
<span class="w">        </span><span class="k">otherwise</span><span class="w"></span>
<span class="w">            </span><span class="nb">error</span><span class="p">(</span><span class="s">&#39;This function takes at least one input argument.&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[ref1,ref2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">noisest </span><span class="p">(</span>Ls,g1,g2,a1,a2,M1,M2,T,F<span class="p">)</span><span class="w"></span>

<span class="c">% computes the entropy for a white noise signal within one supertile</span><span class="w"></span>
<span class="c">% as estimation reference for the tresholds tau1,tau2</span><span class="w"></span>

<span class="n">n</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">noise</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="s">&#39;white&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">n1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"></span>
<span class="n">n2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"></span>
<span class="n">r1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">n1</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">M1</span><span class="o">/</span><span class="n">Ls</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">a1</span><span class="p">));</span><span class="w"></span>
<span class="n">r2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">n2</span><span class="p">(</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">F</span><span class="o">*</span><span class="n">M2</span><span class="o">/</span><span class="n">Ls</span><span class="p">),</span><span class="mi">1</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">T</span><span class="o">/</span><span class="n">a2</span><span class="p">));</span><span class="w"></span>
<span class="n">ref1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">r1</span><span class="p">);</span><span class="w"></span>
<span class="n">ref2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">r2</span><span class="p">);</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%% Version 1 of the jigsaw puzzle algorithm %%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[x1,x2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">jigsaw1</span><span class="p">(</span>R,g1,g2,a1,a2,M1,M2,T,F,tau1,tau2<span class="p">)</span><span class="w"></span>

<span class="c">% error check?</span><span class="w"></span>

<span class="c">% signal lengths</span><span class="w"></span>
<span class="n">Ls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<span class="n">L1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"> </span>
<span class="n">L2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"></span>

<span class="c">% gabor transformations</span><span class="w"></span>
<span class="n">c1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"> </span><span class="c">% M1/2+1-by-L/a1</span><span class="w"></span>
<span class="n">c2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"> </span><span class="c">% M2/2+1-by-L/a2</span><span class="w"></span>

<span class="c">% frequency hop sizes</span><span class="w"></span>
<span class="n">b1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L1</span><span class="o">/</span><span class="n">M1</span><span class="p">;</span><span class="w"></span>
<span class="n">b2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L2</span><span class="o">/</span><span class="n">M2</span><span class="p">;</span><span class="w"></span>

<span class="c">% indices on the TF plane (L/2+1 x L), where the coefficients belong to</span><span class="w"></span>
<span class="n">aa1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">a1</span><span class="p">:</span><span class="n">L1</span><span class="p">;</span><span class="w"></span>
<span class="n">aa2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">a2</span><span class="p">:</span><span class="n">L2</span><span class="p">;</span><span class="w"></span>
<span class="n">bb1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">b1</span><span class="p">:</span><span class="n">L1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">bb2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">b2</span><span class="p">:</span><span class="n">L2</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">]);</span><span class="w"></span>

<span class="c">% find the indices for the coefficients in every single TF-supertile</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c">% look for parts of c1,c2 where tonal/transient parts are repr well</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision1</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% last column of remaining supertiles </span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision1</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% upper row of remaining supertiles</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span>
<span class="w">    </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision1</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% right upper remaining supertiles</span><span class="w"></span>
<span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>

<span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision1</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>


<span class="c">% synthesis with the canonical dual windows</span><span class="w"></span>
<span class="n">x1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">idgtreal</span><span class="p">(</span><span class="n">c1</span><span class="p">,{</span><span class="s">&#39;dual&#39;</span><span class="p">,</span><span class="n">g1</span><span class="p">},</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">Ls</span><span class="p">);</span><span class="w"></span>
<span class="n">x2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">idgtreal</span><span class="p">(</span><span class="n">c2</span><span class="p">,{</span><span class="s">&#39;dual&#39;</span><span class="p">,</span><span class="n">g2</span><span class="p">},</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">Ls</span><span class="p">);</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[c1,c2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">decision1</span><span class="p">(</span>c1,c2,f1,f2,t1,t2,tau1,tau2<span class="p">)</span><span class="w"></span>

<span class="c">% decision procedure for version 1</span><span class="w"></span>
<span class="c">%   case 1: both entropies are above their thresholds -&gt; set them to zero</span><span class="w"></span>
<span class="c">%   case 2: g1 has a better repr. and the entropy is below its</span><span class="w"></span>
<span class="c">%           threshold -&gt; set the tile corr. to g2 to zero</span><span class="w"></span>
<span class="c">%   case 3: vice versa</span><span class="w"></span>
<span class="c">%   case 4: g1 has a better repr. and its entropy is above its</span><span class="w"></span>
<span class="c">%           threshold tau1 but despite of that, the entropy corr. to</span><span class="w"></span>
<span class="c">%           g2 is below its threshold tau2 -&gt; set the tile corr. to</span><span class="w"></span>
<span class="c">%           g1 to zero</span><span class="w"></span>
<span class="c">%   case 5: vice versa</span><span class="w"></span>

<span class="n">E1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">));</span><span class="w"></span>
<span class="n">E2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">));</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau2</span><span class="w"></span>
<span class="w">    </span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w">               </span>
<span class="w">    </span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">else</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tau1</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tau1</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">elseif</span><span class="w"> </span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tau2</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">(</span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau1</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">tau2</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">else</span><span class="w"></span>
<span class="w">        </span><span class="nb">warning</span><span class="p">(</span><span class="s">&#39;something went wrong with the decision criteria!&#39;</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>
<span class="c">%%%%%%%%%%%%%%% Version 2 of the jigsaw puzzle algorithm %%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[x1,x2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">jigsaw2</span><span class="p">(</span>R,g1,g2,a1,a2,M1,M2,T,F,tau1,tau2<span class="p">)</span><span class="w"></span>

<span class="c">% signal lengths</span><span class="w"></span>
<span class="n">Ls</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">length</span><span class="p">(</span><span class="n">R</span><span class="p">);</span><span class="w"></span>
<span class="n">L1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"> </span>
<span class="n">L2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtlength</span><span class="p">(</span><span class="n">Ls</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"></span>

<span class="c">% frequency hop sizes</span><span class="w"></span>
<span class="n">b1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L1</span><span class="o">/</span><span class="n">M1</span><span class="p">;</span><span class="w"></span>
<span class="n">b2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">L2</span><span class="o">/</span><span class="n">M2</span><span class="p">;</span><span class="w"></span>

<span class="c">% gabor transformation</span><span class="w"></span>
<span class="n">c1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"> </span><span class="c">% M1/2+1-by-L/a1</span><span class="w"></span>
<span class="n">c2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">R</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"> </span><span class="c">% M2/2+1-by-L/a2</span><span class="w"></span>

<span class="c">% indices on the TF plane (L/2+1 x L), where the coefficients belong to</span><span class="w"></span>
<span class="n">aa1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">a1</span><span class="p">:</span><span class="n">L1</span><span class="p">;</span><span class="w"></span>
<span class="n">aa2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">a2</span><span class="p">:</span><span class="n">L2</span><span class="p">;</span><span class="w"></span>
<span class="n">bb1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">b1</span><span class="p">:</span><span class="n">L1</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="n">bb2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="n">b2</span><span class="p">:</span><span class="n">L2</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="n">L</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">max</span><span class="p">([</span><span class="n">L1</span><span class="p">,</span><span class="n">L2</span><span class="p">]);</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="c">% find the indices for the coefficients in each TF-supertile</span><span class="w"></span>
<span class="w">        </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c">% keep the tonals</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2ton</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% last column of remaining supertiles </span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">% keep the tonals</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2ton</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% upper row of remaining supertiles</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">% keep the tonals</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2ton</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% right upper remaining supertile</span><span class="w"></span>
<span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="c">% keep the tonals</span><span class="w"></span>
<span class="p">[</span><span class="n">c1</span><span class="p">,</span><span class="o">~</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2ton</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau1</span><span class="p">);</span><span class="w"></span>


<span class="c">% synthesis of the tonal parts with the canonical dual window of g1</span><span class="w"></span>
<span class="n">x1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">idgtreal</span><span class="p">(</span><span class="n">c1</span><span class="p">,{</span><span class="s">&#39;dual&#39;</span><span class="p">,</span><span class="n">g1</span><span class="p">},</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">,</span><span class="n">Ls</span><span class="p">);</span><span class="w"></span>
<span class="n">RR</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">R</span><span class="o">-</span><span class="n">x1</span><span class="p">;</span><span class="w"></span>

<span class="c">% the same procedure is now applied with respect to the narrow window g2</span><span class="w"></span>

<span class="c">% gabor transformation</span><span class="w"></span>
<span class="n">c1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">RR</span><span class="p">,</span><span class="n">g1</span><span class="p">,</span><span class="n">a1</span><span class="p">,</span><span class="n">M1</span><span class="p">);</span><span class="w"> </span><span class="c">% M1/2+1-by-L/a1</span><span class="w"></span>
<span class="n">c2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dgtreal</span><span class="p">(</span><span class="n">RR</span><span class="p">,</span><span class="n">g2</span><span class="p">,</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">);</span><span class="w"> </span><span class="c">% M2/2+1-by-L/a2</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="w">        </span><span class="c">% find the indices for the coefficients in each TF-supertile</span><span class="w"></span>
<span class="w">        </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c">% keep the transients</span><span class="w"></span>
<span class="w">        </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2trans</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% last column of remaining supertiles </span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">m</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">m</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="n">m</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">% keep the transients</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2trans</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% upper row of remaining supertiles</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">n</span><span class="p">=</span><span class="mi">0</span><span class="p">:</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="n">n</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="c">% keep the transients</span><span class="w"></span>
<span class="w">    </span><span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2trans</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="c">% right upper remaining supertile</span><span class="w"></span>
<span class="n">f1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb1</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">f2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">bb2</span><span class="o">&lt;=</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">bb2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">((</span><span class="n">L</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="n">F</span><span class="p">)</span><span class="o">*</span><span class="n">F</span><span class="p">);</span><span class="w"></span>
<span class="n">t1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa1</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa1</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="n">t2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">find</span><span class="p">(</span><span class="n">aa2</span><span class="o">&lt;=</span><span class="n">L</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">aa2</span><span class="o">&gt;</span><span class="nb">floor</span><span class="p">(</span><span class="n">L</span><span class="o">/</span><span class="n">T</span><span class="p">)</span><span class="o">*</span><span class="n">T</span><span class="p">);</span><span class="w"></span>
<span class="c">% keep the transients</span><span class="w"></span>
<span class="p">[</span><span class="o">~</span><span class="p">,</span><span class="n">c2</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">decision2trans</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span><span class="n">c2</span><span class="p">,</span><span class="n">f1</span><span class="p">,</span><span class="n">f2</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">,</span><span class="n">tau2</span><span class="p">);</span><span class="w"></span>


<span class="c">% synthesis of the transient parts with the canonical dual window of g2</span><span class="w"></span>
<span class="n">x2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">idgtreal</span><span class="p">(</span><span class="n">c2</span><span class="p">,{</span><span class="s">&#39;dual&#39;</span><span class="p">,</span><span class="n">g2</span><span class="p">},</span><span class="n">a2</span><span class="p">,</span><span class="n">M2</span><span class="p">,</span><span class="n">Ls</span><span class="p">);</span><span class="w"></span>

<span class="c">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[c1,c2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">decision2ton</span><span class="p">(</span>c1,c2,f1,f2,t1,t2,tau1<span class="p">)</span><span class="w"></span>
<span class="c">% decision procedure for tonals</span><span class="w"></span>

<span class="n">E1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">));</span><span class="w"></span>
<span class="n">E2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">));</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau1</span><span class="w"></span>
<span class="w">    </span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="k">function</span><span class="w"> </span>[c1,c2]<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">decision2trans</span><span class="p">(</span>c1,c2,f1,f2,t1,t2,tau2<span class="p">)</span><span class="w"></span>
<span class="c">% decision procedure for transients</span><span class="w"></span>

<span class="n">E1</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c1</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">t1</span><span class="p">));</span><span class="w"></span>
<span class="n">E2</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">renyi</span><span class="p">(</span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">));</span><span class="w"></span>

<span class="k">if</span><span class="w"> </span><span class="nb">min</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span><span class="n">E2</span><span class="p">])</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">E1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">E2</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">tau2</span><span class="w"></span>
<span class="w">    </span><span class="n">c2</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">t2</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>


        <div class="include" file="../../include/footer.html"></div>
    </div>
</div>
<!-- These two have to be here to dynamically load the included parts -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script
src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.6.5/js/bootstrap-select.min.js"></script>
<script src="../../js/ltfat.js" type="text/javascript"></script>
<script src="../include/lookup.js" type="text/javascript"></script>
<script src="../include/jumplist.js" type="text/javascript"></script>
</body>
</html>

